#!/usr/bin/env bash

if [[ $# -eq 1 ]]; then
  dir_name=$(realpath "$1")
else
  dir_name=$(find ~/projects ~/projects/halpme -type d -maxdepth 1 | fzf)
fi

if [[ -z $dir_name ]]; then
  exit 0
fi

session_name=$(basename "$dir_name" | tr . _)

if ! tmux has-session -t "$session_name" 2>/dev/null; then
  tmux new -ds $session_name -c "$dir_name" -n editor
  tmux send-keys -t "$session_name:editor" "nvim" c-M

  tmux neww -t "$session_name" -c "$dir_name" -n terminal
  tmux neww -t "$session_name" -c "$dir_name" -n server
  tmux neww -t "$session_name" -c "$dir_name" -n ai-chat
  tmux neww -t "$session_name" -c "$dir_name" -n database
fi

if [[ -n "$TMUX" ]]; then
  tmux switch-client -t "$session_name:0"
else
  tmux attach-session -t "$session_name:0"
fi
